// ============================================
// SnokOS - Multilingual Website
// ============================================

// Translation Data
const translations = {
  en: {
    // Navigation
    logo: "SnokOS",
    downloadBtn: "Download",
    // Hero Section
    heroTitle: "Build The Future With",
    heroTitleHighlight: "SnokOS",
    heroSubtitle: "Specialized in designing and developing websites, software, and systems of all kinds. Supporting open-source solutions.",
    ctaGetStarted: "Get Started",
    ctaLearnMore: "Learn More",

    // Services Section
    servicesTitle: "Our Services",
    servicesSubtitle: "Comprehensive solutions for your digital needs",

    service1Title: "Web Development",
    service1Desc: "Modern, responsive websites built with cutting-edge technologies and best practices.",

    service2Title: "Software Development",
    service2Desc: "Custom software solutions tailored to your business requirements and workflows.",

    service3Title: "System Design",
    service3Desc: "Scalable system architecture and infrastructure design for enterprise applications.",

    service4Title: "Open Source",
    service4Desc: "Contributing to and supporting open-source projects and communities worldwide.",

    // About Section
    aboutTitle: "About SnokOS",
    aboutSubtitle: "Innovation Meets Excellence",
    aboutText1: "SnokOS is a leading technology company specializing in web development, software engineering, and system architecture. We are passionate about creating innovative solutions that empower businesses and individuals.",
    aboutText2: "Our commitment to open-source software drives us to contribute to the global developer community while delivering exceptional, customized solutions for our clients.",
    aboutText3: "With a team of experienced developers and designers, we transform ideas into reality using modern technologies and industry best practices.",

    // Contact Section
    contactTitle: "Get In Touch",
    contactSubtitle: "Let's build something amazing together",
    contactName: "Your Name",
    contactEmail: "Your Email",
    contactMessage: "Your Message",
    contactSubmit: "Send Message",

    // Footer
    footerAbout: "About",
    footerAboutText: "SnokOS is dedicated to delivering cutting-edge technology solutions and supporting the open-source community.",
    footerQuickLinks: "Quick Links",
    footerServices: "Services",
    footerAboutUs: "About Us",
    footerContact: "Contact",
    footerBlog: "Blog",
    footerConnect: "Connect",
    footerContactHeader: "Contact",
    footerEmailLabel: "Email",
    footerPhoneLabel: "Phone",
    footerLocationLabel: "Location",
    locationName: "Tunis",
    footerCopyright: "Â© 2025 SnokOS. All rights reserved.",

    // Mockup Section
    mockupTitle: "Experience Our Design",
    mockupSubtitle: "Interactive 3D preview with glassmorphism effects",
  },

  fr: {
    // Navigation
    logo: "SnokOS",
    downloadBtn: "TÃ©lÃ©charger",
    // Hero Section
    heroTitle: "Construisez l'avenir avec",
    heroTitleHighlight: "SnokOS",
    heroSubtitle: "SpÃ©cialisÃ© dans la conception et le dÃ©veloppement de sites Web, de logiciels et de systÃ¨mes de toutes sortes. Soutien des solutions open-source.",
    ctaGetStarted: "Commencer",
    ctaLearnMore: "En savoir plus",

    // Services Section
    servicesTitle: "Nos Services",
    servicesSubtitle: "Des solutions complÃ¨tes pour vos besoins numÃ©riques",

    service1Title: "DÃ©veloppement Web",
    service1Desc: "Sites Web modernes et rÃ©actifs construits avec des technologies de pointe et les meilleures pratiques.",

    service2Title: "DÃ©veloppement Logiciel",
    service2Desc: "Solutions logicielles personnalisÃ©es adaptÃ©es aux exigences et aux flux de travail de votre entreprise.",

    service3Title: "Conception de SystÃ¨mes",
    service3Desc: "Architecture systÃ¨me Ã©volutive et conception d'infrastructure pour applications d'entreprise.",

    service4Title: "Open Source",
    service4Desc: "Contribution et soutien aux projets et communautÃ©s open-source dans le monde entier.",

    // About Section
    aboutTitle: "Ã€ propos de SnokOS",
    aboutSubtitle: "L'innovation rencontre l'excellence",
    aboutText1: "SnokOS est une entreprise technologique de premier plan spÃ©cialisÃ©e dans le dÃ©veloppement Web, l'ingÃ©nierie logicielle et l'architecture systÃ¨me. Nous sommes passionnÃ©s par la crÃ©ation de solutions innovantes qui responsabilisent les entreprises et les individus.",
    aboutText2: "Notre engagement envers les logiciels open-source nous pousse Ã  contribuer Ã  la communautÃ© mondiale des dÃ©veloppeurs tout en fournissant des solutions exceptionnelles et personnalisÃ©es Ã  nos clients.",
    aboutText3: "Avec une Ã©quipe de dÃ©veloppeurs et de designers expÃ©rimentÃ©s, nous transformons les idÃ©es en rÃ©alitÃ© en utilisant des technologies modernes et les meilleures pratiques de l'industrie.",

    // Contact Section
    contactTitle: "Contactez-nous",
    contactSubtitle: "Construisons quelque chose d'incroyable ensemble",
    contactName: "Votre nom",
    contactEmail: "Votre email",
    contactMessage: "Votre message",
    contactSubmit: "Envoyer le message",

    // Footer
    footerAbout: "Ã€ propos",
    footerAboutText: "SnokOS se consacre Ã  fournir des solutions technologiques de pointe et Ã  soutenir la communautÃ© open-source.",
    footerQuickLinks: "Liens rapides",
    footerServices: "Services",
    footerAboutUs: "Ã€ propos",
    footerContact: "Contact",
    footerBlog: "Blog",
    footerConnect: "Connecter",
    footerContactHeader: "Contact",
    footerEmailLabel: "Email",
    footerPhoneLabel: "TÃ©lÃ©phone",
    footerLocationLabel: "Localisation",
    locationName: "Tunis",
    footerCopyright: "Â© 2025 SnokOS. Tous droits rÃ©servÃ©s.",

    // Mockup Section
    mockupTitle: "DÃ©couvrez Notre Design",
    mockupSubtitle: "AperÃ§u 3D interactif avec effets glassmorphism",
  },

  ar: {
    // Navigation
    logo: "SnokOS",

    // Hero Section
    heroTitle: "Ø§Ø¨Ù†Ù Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…Ø¹",
    heroTitleHighlight: "SnokOS",
    heroSubtitle: "Ù…ØªØ®ØµØµÙˆÙ† ÙÙŠ ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ± Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ ÙˆØ§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø£Ù†Ø¸Ù…Ø© Ø¨Ù…Ø®ØªÙ„Ù Ø£Ù†ÙˆØ§Ø¹Ù‡Ø§. Ù†Ø¯Ø¹Ù… Ø§Ù„Ø­Ù„ÙˆÙ„ Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ù…ØµØ¯Ø±.",
    ctaGetStarted: "Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†",
    ctaLearnMore: "Ø§Ø¹Ø±Ù Ø§Ù„Ù…Ø²ÙŠØ¯",

    // Services Section
    servicesTitle: "Ø®Ø¯Ù…Ø§ØªÙ†Ø§",
    servicesSubtitle: "Ø­Ù„ÙˆÙ„ Ø´Ø§Ù…Ù„Ø© Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§ØªÙƒ Ø§Ù„Ø±Ù‚Ù…ÙŠØ©",

    service1Title: "ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹",
    service1Desc: "Ù…ÙˆØ§Ù‚Ø¹ ÙˆÙŠØ¨ Ø­Ø¯ÙŠØ«Ø© ÙˆÙ…ØªØ¬Ø§ÙˆØ¨Ø© Ù…Ø¨Ù†ÙŠØ© Ø¨Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª ÙˆØ£ÙØ¶Ù„ Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª.",

    service2Title: "ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª",
    service2Desc: "Ø­Ù„ÙˆÙ„ Ø¨Ø±Ù…Ø¬ÙŠØ© Ù…Ø®ØµØµØ© Ù…ØµÙ…Ù…Ø© ÙˆÙÙ‚Ø§Ù‹ Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¹Ù…Ù„Ùƒ ÙˆØ³ÙŠØ± Ø§Ù„Ø¹Ù…Ù„.",

    service3Title: "ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ù†Ø¸Ù…Ø©",
    service3Desc: "Ø¨Ù†ÙŠØ© Ø£Ù†Ø¸Ù…Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·ÙˆÙŠØ± ÙˆØªØµÙ…ÙŠÙ… Ø¨Ù†ÙŠØ© ØªØ­ØªÙŠØ© Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª.",

    service4Title: "Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…ÙØªÙˆØ­Ø©",
    service4Desc: "Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ ÙˆØ¯Ø¹Ù… Ù…Ø´Ø§Ø±ÙŠØ¹ ÙˆÙ…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø­ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù….",

    // About Section
    aboutTitle: "Ø¹Ù† SnokOS",
    aboutSubtitle: "Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± ÙŠÙ„ØªÙ‚ÙŠ Ø¨Ø§Ù„ØªÙ…ÙŠØ²",
    aboutText1: "SnokOS Ù‡ÙŠ Ø´Ø±ÙƒØ© ØªÙ‚Ù†ÙŠØ© Ø±Ø§Ø¦Ø¯Ø© Ù…ØªØ®ØµØµØ© ÙÙŠ ØªØ·ÙˆÙŠØ± Ø§Ù„ÙˆÙŠØ¨ ÙˆÙ‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª ÙˆØ¨Ù†ÙŠØ© Ø§Ù„Ø£Ù†Ø¸Ù…Ø©. Ù†Ø­Ù† Ø´ØºÙˆÙÙˆÙ† Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø­Ù„ÙˆÙ„ Ù…Ø¨ØªÙƒØ±Ø© ØªÙ…ÙƒÙ‘Ù† Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„Ø£ÙØ±Ø§Ø¯.",
    aboutText2: "Ø§Ù„ØªØ²Ø§Ù…Ù†Ø§ Ø¨Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ù…ØµØ¯Ø± ÙŠØ¯ÙØ¹Ù†Ø§ Ù„Ù„Ù…Ø³Ø§Ù‡Ù…Ø© ÙÙŠ Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù…Ø¹ ØªÙ‚Ø¯ÙŠÙ… Ø­Ù„ÙˆÙ„ Ø§Ø³ØªØ«Ù†Ø§Ø¦ÙŠØ© ÙˆÙ…Ø®ØµØµØ© Ù„Ø¹Ù…Ù„Ø§Ø¦Ù†Ø§.",
    aboutText3: "Ù…Ø¹ ÙØ±ÙŠÙ‚ Ù…Ù† Ø§Ù„Ù…Ø·ÙˆØ±ÙŠÙ† ÙˆØ§Ù„Ù…ØµÙ…Ù…ÙŠÙ† Ø°ÙˆÙŠ Ø§Ù„Ø®Ø¨Ø±Ø©ØŒ Ù†Ø­ÙˆÙ„ Ø§Ù„Ø£ÙÙƒØ§Ø± Ø¥Ù„Ù‰ ÙˆØ§Ù‚Ø¹ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø© ÙˆØ£ÙØ¶Ù„ Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹Ø©.",

    // Contact Section
    contactTitle: "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
    contactSubtitle: "Ù„Ù†Ø¨Ù†ÙŠ Ø´ÙŠØ¦Ø§Ù‹ Ø±Ø§Ø¦Ø¹Ø§Ù‹ Ù…Ø¹Ø§Ù‹",
    contactName: "Ø§Ø³Ù…Ùƒ",
    contactEmail: "Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
    contactMessage: "Ø±Ø³Ø§Ù„ØªÙƒ",
    contactSubmit: "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©",

    // Footer
    footerAbout: "Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ©",
    footerAboutText: "SnokOS Ù…Ù„ØªØ²Ù…Ø© Ø¨ØªÙ‚Ø¯ÙŠÙ… Ø­Ù„ÙˆÙ„ ØªÙ‚Ù†ÙŠØ© Ù…ØªØ·ÙˆØ±Ø© ÙˆØ¯Ø¹Ù… Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…ÙØªÙˆØ­Ø©.",
    footerQuickLinks: "Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©",
    footerServices: "Ø§Ù„Ø®Ø¯Ù…Ø§Øª",
    footerAboutUs: "Ù…Ù† Ù†Ø­Ù†",
    footerContact: "Ø§ØªØµÙ„ Ø¨Ù†Ø§",
    footerBlog: "Ø§Ù„Ù…Ø¯ÙˆÙ†Ø©",
    footerConnect: "ØªÙˆØ§ØµÙ„",
    footerContactHeader: "ØªÙˆØ§ØµÙ„",
    footerEmailLabel: "Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ",
    footerPhoneLabel: "Ø§Ù„Ù‡Ø§ØªÙ",
    footerLocationLabel: "Ø§Ù„Ù…ÙˆÙ‚Ø¹",
    locationName: "ØªÙˆÙ†Ø³",
    footerCopyright: "Â© 2025 SnokOS. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.",

    // Mockup Section
    mockupTitle: "Ø§Ø®ØªØ¨Ø± ØªØµÙ…ÙŠÙ…Ù†Ø§",
    mockupSubtitle: "Ù…Ø¹Ø§ÙŠÙ†Ø© Ø«Ù„Ø§Ø«ÙŠØ© Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ ØªÙØ§Ø¹Ù„ÙŠØ© Ù…Ø¹ ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø²Ø¬Ø§Ø¬ Ø§Ù„Ù…ØµÙ†ÙØ±",
  }
};

// ============================================
// State Management
// ============================================

let currentLang = localStorage.getItem('language') || 'en';
let currentTheme = localStorage.getItem('theme') || 'dark';

// ============================================
// Language Switching
// ============================================

function setLanguage(lang) {
  currentLang = lang;
  localStorage.setItem('language', lang);

  // Update HTML lang and dir attributes
  document.documentElement.lang = lang;
  document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
  document.body.setAttribute('lang', lang);

  // Update all translatable elements
  updateContent();

  // Update active language button
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.classList.remove('active');
    if (btn.dataset.lang === lang) {
      btn.classList.add('active');
    }
  });
}

function updateContent() {
  const t = translations[currentLang];

  // Update all elements with data-i18n attribute
  document.querySelectorAll('[data-i18n]').forEach(element => {
    const key = element.dataset.i18n;
    if (t[key]) {
      if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
        element.placeholder = t[key];
      } else {
        element.textContent = t[key];
      }
    }
  });
}

// ============================================
// Theme Switching
// ============================================

function setTheme(theme) {
  currentTheme = theme;
  localStorage.setItem('theme', theme);
  document.documentElement.setAttribute('data-theme', theme);

  // Update theme toggle icon
  const themeToggle = document.querySelector('.theme-toggle');
  if (themeToggle) {
    themeToggle.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
  }
}

function toggleTheme() {
  const newTheme = currentTheme === 'light' ? 'dark' : 'light';
  setTheme(newTheme);
}

// ============================================
// Scroll Animations
// ============================================

function initScrollAnimations() {
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, observerOptions);

  document.querySelectorAll('.fade-in').forEach(el => {
    observer.observe(el);
  });
}

// ============================================
// Form Handling
// ============================================

function handleFormSubmit(e) {
  e.preventDefault();

  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);

  console.log('Form submitted:', data);

  // Show success message (you can customize this)
  alert(currentLang === 'en' ? 'Message sent successfully!' :
    currentLang === 'fr' ? 'Message envoyÃ© avec succÃ¨s!' :
      'ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');

  e.target.reset();
}

// ============================================
// Smooth Scroll
// ============================================

function smoothScroll(target) {
  const element = document.querySelector(target);
  if (element) {
    element.scrollIntoView({
      behavior: 'smooth',
      block: 'start'
    });
  }
}

// ============================================
// Initialization
// ============================================

document.addEventListener('DOMContentLoaded', () => {
  // Initialize theme
  setTheme(currentTheme);

  // Initialize language
  setLanguage(currentLang);

  // Initialize scroll animations
  initScrollAnimations();

  // Language switcher event listeners
  document.querySelectorAll('.lang-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      setLanguage(btn.dataset.lang);
    });
  });

  // Theme toggle event listener
  const themeToggle = document.querySelector('.theme-toggle');
  if (themeToggle) {
    themeToggle.addEventListener('click', toggleTheme);
  }

  // Contact form event listener
  const contactForm = document.querySelector('.contact-form');
  if (contactForm) {
    contactForm.addEventListener('submit', handleFormSubmit);
  }

  // Smooth scroll for anchor links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      e.preventDefault();
      const target = this.getAttribute('href');
      if (target !== '#') {
        smoothScroll(target);
      }
    });
  });
});

// ============================================
// Navbar Scroll Effect
// ============================================

let lastScroll = 0;
window.addEventListener('scroll', () => {
  const navbar = document.querySelector('.navbar');
  const currentScroll = window.pageYOffset;

  if (currentScroll > 100) {
    navbar.style.boxShadow = 'var(--shadow-md)';
  } else {
    navbar.style.boxShadow = 'none';
  }

  lastScroll = currentScroll;
});

// ============================================
// Loading Screen
// ============================================

window.addEventListener('load', () => {
  const loadingScreen = document.querySelector('.loading-screen');

  // Hide loading screen after a minimum display time
  setTimeout(() => {
    loadingScreen.classList.add('hidden');

    // Remove from DOM after transition
    setTimeout(() => {
      loadingScreen.remove();
    }, 500);
  }, 1500); // Show for at least 1.5 seconds
});

// ============================================
// 3D Network Grid Background
// ============================================

class NetworkBackground {
  constructor() {
    this.canvas = document.getElementById('network-canvas');
    if (!this.canvas) return;

    this.ctx = this.canvas.getContext('2d');
    this.particles = [];
    this.mouse = { x: null, y: null, radius: 150 };
    this.animationId = null;

    this.init();
    this.setupEventListeners();
    this.animate();
  }

  init() {
    this.resizeCanvas();
    this.createParticles();
  }

  resizeCanvas() {
    this.canvas.width = window.innerWidth;
    this.canvas.height = window.innerHeight;
  }

  createParticles() {
    const numberOfParticles = Math.floor((this.canvas.width * this.canvas.height) / 15000);
    this.particles = [];

    for (let i = 0; i < numberOfParticles; i++) {
      this.particles.push({
        x: Math.random() * this.canvas.width,
        y: Math.random() * this.canvas.height,
        z: Math.random() * 1000,
        vx: (Math.random() - 0.5) * 0.5,
        vy: (Math.random() - 0.5) * 0.5,
        vz: (Math.random() - 0.5) * 0.5,
        radius: Math.random() * 2 + 1
      });
    }
  }

  setupEventListeners() {
    window.addEventListener('resize', () => {
      this.resizeCanvas();
      this.createParticles();
    });

    window.addEventListener('mousemove', (e) => {
      this.mouse.x = e.x;
      this.mouse.y = e.y;
    });

    window.addEventListener('mouseout', () => {
      this.mouse.x = null;
      this.mouse.y = null;
    });
  }

  drawParticle(particle) {
    // Calculate 3D projection
    const scale = 1000 / (1000 + particle.z);
    const x2d = (particle.x - this.canvas.width / 2) * scale + this.canvas.width / 2;
    const y2d = (particle.y - this.canvas.height / 2) * scale + this.canvas.height / 2;
    const radius = particle.radius * scale;

    // Get theme colors
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
    const particleColor = isDark ? 'rgba(139, 92, 246, 0.8)' : 'rgba(109, 40, 217, 0.6)';

    this.ctx.beginPath();
    this.ctx.arc(x2d, y2d, radius, 0, Math.PI * 2);
    this.ctx.fillStyle = particleColor;
    this.ctx.fill();

    return { x: x2d, y: y2d, scale };
  }

  connectParticles(particles2D) {
    const isDark = document.documentElement.getAttribute('data-theme') === 'dark';

    for (let i = 0; i < particles2D.length; i++) {
      for (let j = i + 1; j < particles2D.length; j++) {
        const dx = particles2D[i].x - particles2D[j].x;
        const dy = particles2D[i].y - particles2D[j].y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < 120) {
          const opacity = (1 - distance / 120) * 0.5;
          const lineColor = isDark
            ? `rgba(139, 92, 246, ${opacity})`
            : `rgba(109, 40, 217, ${opacity})`;

          this.ctx.beginPath();
          this.ctx.strokeStyle = lineColor;
          this.ctx.lineWidth = 0.5;
          this.ctx.moveTo(particles2D[i].x, particles2D[i].y);
          this.ctx.lineTo(particles2D[j].x, particles2D[j].y);
          this.ctx.stroke();
        }
      }

      // Connect to mouse
      if (this.mouse.x != null && this.mouse.y != null) {
        const dx = particles2D[i].x - this.mouse.x;
        const dy = particles2D[i].y - this.mouse.y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < this.mouse.radius) {
          const opacity = (1 - distance / this.mouse.radius) * 0.8;
          const lineColor = isDark
            ? `rgba(168, 85, 247, ${opacity})`
            : `rgba(147, 51, 234, ${opacity})`;

          this.ctx.beginPath();
          this.ctx.strokeStyle = lineColor;
          this.ctx.lineWidth = 1;
          this.ctx.moveTo(particles2D[i].x, particles2D[i].y);
          this.ctx.lineTo(this.mouse.x, this.mouse.y);
          this.ctx.stroke();
        }
      }
    }
  }

  updateParticles() {
    this.particles.forEach(particle => {
      // Update position
      particle.x += particle.vx;
      particle.y += particle.vy;
      particle.z += particle.vz;

      // Wrap around edges
      if (particle.x < 0) particle.x = this.canvas.width;
      if (particle.x > this.canvas.width) particle.x = 0;
      if (particle.y < 0) particle.y = this.canvas.height;
      if (particle.y > this.canvas.height) particle.y = 0;
      if (particle.z < 0) particle.z = 1000;
      if (particle.z > 1000) particle.z = 0;

      // Mouse interaction
      if (this.mouse.x != null && this.mouse.y != null) {
        const dx = this.mouse.x - particle.x;
        const dy = this.mouse.y - particle.y;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < this.mouse.radius) {
          const force = (this.mouse.radius - distance) / this.mouse.radius;
          const angle = Math.atan2(dy, dx);
          particle.vx -= Math.cos(angle) * force * 0.1;
          particle.vy -= Math.sin(angle) * force * 0.1;
        }
      }

      // Apply friction
      particle.vx *= 0.99;
      particle.vy *= 0.99;
      particle.vz *= 0.99;

      // Keep minimum velocity
      if (Math.abs(particle.vx) < 0.1) particle.vx += (Math.random() - 0.5) * 0.1;
      if (Math.abs(particle.vy) < 0.1) particle.vy += (Math.random() - 0.5) * 0.1;
      if (Math.abs(particle.vz) < 0.1) particle.vz += (Math.random() - 0.5) * 0.1;
    });
  }

  animate() {
    // Clear canvas
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

    // Update particles
    this.updateParticles();

    // Draw particles and get 2D positions
    const particles2D = this.particles.map(p => this.drawParticle(p));

    // Connect particles
    this.connectParticles(particles2D);

    // Continue animation
    this.animationId = requestAnimationFrame(() => this.animate());
  }

  destroy() {
    if (this.animationId) {
      cancelAnimationFrame(this.animationId);
    }
  }
}

// Initialize network background after page load
window.addEventListener('load', () => {
  // Small delay to ensure canvas is ready
  setTimeout(() => {
    if (window.innerWidth > 480) { // Only on larger screens
      new NetworkBackground();
    }
  }, 100);
});
